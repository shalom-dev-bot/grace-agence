{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Event Details" %} - {{ event.title }} - Glow Gracious Events{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="py-12 sm:py-16 md:py-20 bg-gradient-to-r from-pink-100 via-yellow-400 to-pink-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center animate-fadeInUp">
    <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-pink-700 mb-4 relative after:content-[''] after:absolute after:w-16 after:h-1 after:bg-yellow-400 after:left-1/2 after:-translate-x-1/2 after:bottom-[-8px]">
      {{ event.title }}
    </h1>
    <p class="text-base sm:text-lg md:text-xl text-gray-800 italic">
      {% trans "Explore the details of your event" %}
    </p>
  </div>
</section>

<!-- Event Details Card -->
<section class="py-8 sm:py-12 md:py-16 bg-pink-100">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="bg-white rounded-3xl shadow-lg border border-yellow-400 p-4 sm:p-6 md:p-10 animate-fadeIn">
      
      <!-- Event Image -->
      <div class="w-full mb-6">
        {% if event.image %}
          <img src="{{ event.image.url }}" alt="{{ event.title }}" class="w-full h-48 sm:h-64 md:h-72 object-cover rounded-2xl shadow-md">
        {% elif event.invitation_card.preview_image %}
          <img src="{{ event.invitation_card.preview_image.url }}" alt="{{ event.title }} Invitation" class="w-full h-48 sm:h-64 md:h-72 object-cover rounded-2xl shadow-md">
        {% else %}
          <div class="w-full h-48 sm:h-64 md:h-72 bg-yellow-400/30 rounded-2xl flex items-center justify-center text-pink-700">
            <i data-lucide="image-off" class="w-10 sm:w-12 h-10 sm:h-12"></i>
          </div>
        {% endif %}
      </div>
      
      <!-- Event Description -->
      <h2 class="text-xl sm:text-2xl md:text-3xl font-bold text-pink-700 mb-4">{{ event.title }}</h2>
      <p class="text-gray-800 text-sm sm:text-base md:text-lg mb-6">{{ event.description|default:"No description available." }}</p>
      
      <!-- Grid Info -->
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 sm:gap-6">
        <div class="animate-fadeUp">
          <p class="text-yellow-400 text-sm sm:text-base font-semibold mb-2">
            <i data-lucide="calendar" class="inline-block w-4 sm:w-5 h-4 sm:h-5 mr-1 sm:mr-2"></i>
            {% trans "Event Date" %}
          </p>
          <p class="text-gray-800 text-sm sm:text-base">{{ event.event_date|date:"F d, Y H:i" }}</p>
        </div>
        
        <div class="animate-fadeUp delay-100">
          <p class="text-yellow-400 text-sm sm:text-base font-semibold mb-2">
            <i data-lucide="tag" class="inline-block w-4 sm:w-5 h-4 sm:h-5 mr-1 sm:mr-2"></i>
            {% trans "Event Type" %}
          </p>
          <p class="text-gray-800 text-sm sm:text-base">{{ event.event_type.name|default:"Not specified" }}</p>
        </div>
        
        <div class="animate-fadeUp delay-200">
          <p class="text-yellow-400 text-sm sm:text-base font-semibold mb-2">
            <i data-lucide="check-circle" class="inline-block w-4 sm:w-5 h-4 sm:h-5 mr-1 sm:mr-2"></i>
            {% trans "Status" %}
          </p>
          <p class="text-gray-800 text-sm sm:text-base">{{ event.get_status_display|default:"Not specified" }}</p>
        </div>
        
        <div class="animate-fadeUp delay-300">
          <p class="text-yellow-400 text-sm sm:text-base font-semibold mb-2">
            <i data-lucide="map-pin" class="inline-block w-4 sm:w-5 h-4 sm:h-5 mr-1 sm:mr-2"></i>
            {% trans "Location" %}
          </p>
          <p class="text-gray-800 text-sm sm:text-base">{{ event.location|default:"Not specified" }}</p>
        </div>
        
        <div class="animate-fadeUp delay-400">
          <p class="text-yellow-400 text-sm sm:text-base font-semibold mb-2">
            <i data-lucide="users" class="inline-block w-4 sm:w-5 h-4 sm:h-5 mr-1 sm:mr-2"></i>
            {% trans "Expected Guests" %}
          </p>
          <p class="text-gray-800 text-sm sm:text-base">{{ event.guest_count|default:"Not specified" }}</p>
        </div>
        
        <div class="animate-fadeUp delay-500">
          <p class="text-yellow-400 text-sm sm:text-base font-semibold mb-2">
            <i data-lucide="dollar-sign" class="inline-block w-4 sm:w-5 h-4 sm:h-5 mr-1 sm:mr-2"></i>
            {% trans "Budget (€)" %}
          </p>
          <p class="text-gray-800 text-sm sm:text-base">{{ event.budget|floatformat:2|default:"Not specified" }}</p>
        </div>
        
        <div class="animate-fadeUp delay-600">
          <p class="text-yellow-400 text-sm sm:text-base font-semibold mb-2">
            <i data-lucide="mail" class="inline-block w-4 sm:w-5 h-4 sm:h-5 mr-1 sm:mr-2"></i>
            {% trans "Invitation Card" %}
          </p>
          <p class="text-gray-800 text-sm sm:text-base">{{ event.invitation_card.name|default:"Not specified" }} ({{ event.invitation_card.get_style_display|default:"Not specified" }})</p>
        </div>
        
        <div class="animate-fadeUp delay-700">
          <p class="text-yellow-400 text-sm sm:text-base font-semibold mb-2">
            <i data-lucide="user" class="inline-block w-4 sm:w-5 h-4 sm:h-5 mr-1 sm:mr-2"></i>
            {% trans "Organizer" %}
          </p>
          <p class="text-gray-800 text-sm sm:text-base">{{ event.user.email|default:"Not specified" }}</p>
        </div>
      </div>
      
      <!-- Event Services -->
      {% if event.event_services.exists %}
          <div class="mt-6 sm:mt-8 md:mt-10 animate-fadeUp delay-800">
              <h3 class="text-lg sm:text-xl md:text-2xl font-semibold text-pink-700 mb-4">{% trans "Selected Services" %}</h3>
              <ul class="space-y-2">
                  {% for event_service in event.event_services.all %}
                      <li class="text-gray-800 text-sm sm:text-base">
                          <span class="font-medium">{{ event_service.service.name }}</span>
                          (Quantity: {{ event_service.quantity }})
                          {% if event_service.notes %}
                              - {{ event_service.notes|truncatewords:10 }}
                          {% endif %}
                      </li>
                  {% endfor %}
              </ul>
          </div>
      {% endif %}

      <!-- Available Services -->
      {% if available_services %}
          <div class="mt-6 sm:mt-8 md:mt-10 animate-fadeUp delay-900">
              <h3 class="text-lg sm:text-xl md:text-2xl font-semibold text-pink-700 mb-4">{% trans "Add Services" %}</h3>
              <form method="post" action="{% url 'add_event_service' event_id=event.id %}" class="space-y-4">
                  {% csrf_token %}
                  <div>
                      <label for="service" class="block text-sm sm:text-base md:text-lg font-medium text-pink-700 mb-2">
                          {% trans "Select Service" %}
                      </label>
                      <select name="service" id="service" class="w-full rounded-lg px-3 sm:px-4 py-2 sm:py-3 bg-white/70 border border-pink-700/40 text-gray-800 text-sm sm:text-base
                              focus:outline-none focus:ring-4 focus:ring-yellow-400/50 focus:border-yellow-400 transition">
                          {% for service in available_services %}
                              <option value="{{ service.id }}">{{ service.name }}</option>
                          {% endfor %}
                      </select>
                  </div>
                  <div>
                      <label for="quantity" class="block text-sm sm:text-base md:text-lg font-medium text-pink-700 mb-2">
                          {% trans "Quantity" %}
                      </label>
                      <input type="number" name="quantity" id="quantity" min="1" value="1" 
                             class="w-full rounded-lg px-3 sm:px-4 py-2 sm:py-3 bg-white/70 border border-pink-700/40 text-gray-800 text-sm sm:text-base
                                    focus:outline-none focus:ring-4 focus:ring-yellow-400/50 focus:border-yellow-400 transition">
                  </div>
                  <div>
                      <label for="notes" class="block text-sm sm:text-base md:text-lg font-medium text-pink-700 mb-2">
                          {% trans "Notes" %}
                      </label>
                      <textarea name="notes" id="notes" rows="3" 
                                class="w-full rounded-lg px-3 sm:px-4 py-2 sm:py-3 bg-white/70 border border-pink-700/40 text-gray-800 text-sm sm:text-base
                                       placeholder-gray-400 focus:outline-none focus:ring-4 focus:ring-yellow-400/50 focus:border-yellow-400 transition"></textarea>
                  </div>
                  <button type="submit" 
                          class="px-4 sm:px-6 py-2 sm:py-3 rounded-lg bg-gradient-to-r from-pink-700 to-yellow-400 text-white font-bold text-sm sm:text-base hover:scale-105 transform transition duration-300">
                      {% trans "Add Service" %}
                  </button>
              </form>
          </div>
      {% endif %}

      <!-- Invitation Card Selection -->
      {% if invitation_cards %}
          <div class="mt-6 sm:mt-8 md:mt-10 animate-fadeUp delay-1000">
              <h3 class="text-lg sm:text-xl md:text-2xl font-semibold text-pink-700 mb-4">{% trans "Update Invitation Card" %}</h3>
              <form method="post" action="{% url 'update_event_invitation' event_id=event.id %}" class="space-y-4">
                  {% csrf_token %}
                  <div>
                      <label for="invitation_card" class="block text-sm sm:text-base md:text-lg font-medium text-pink-700 mb-2">
                          {% trans "Select Invitation Card" %}
                      </label>
                      <select name="invitation_card" id="invitation_card" 
                              class="w-full rounded-lg px-3 sm:px-4 py-2 sm:py-3 bg-white/70 border border-pink-700/40 text-gray-800 text-sm sm:text-base
                                     focus:outline-none focus:ring-4 focus:ring-yellow-400/50 focus:border-yellow-400 transition">
                          <option value="">{% trans "No invitation card" %}</option>
                          {% for card in invitation_cards %}
                              <option value="{{ card.id }}" {% if event.invitation_card.id == card.id %}selected{% endif %}>
                                  {{ card.name }} ({{ card.get_style_display }})
                              </option>
                          {% endfor %}
                      </select>
                  </div>
                  <button type="submit" 
                          class="px-4 sm:px-6 py-2 sm:py-3 rounded-lg bg-gradient-to-r from-pink-700 to-yellow-400 text-white font-bold text-sm sm:text-base hover:scale-105 transform transition duration-300">
                      {% trans "Update Invitation" %}
                  </button>
              </form>
          </div>
      {% endif %}

      {% if user.is_authenticated %}
          <div class="flex flex-col sm:flex-row justify-end space-y-4 sm:space-y-0 sm:space-x-4 mt-6 sm:mt-8 md:mt-10 animate-fadeUp delay-1100">
              <a href="{% url 'dashboard' %}" 
                 class="w-full sm:w-auto px-4 sm:px-5 py-2 sm:py-3 rounded-lg bg-yellow-400 text-pink-700 font-semibold text-sm sm:text-base hover:bg-pink-200 transition transform hover:scale-105">
                  <i data-lucide="arrow-left" class="w-4 sm:w-5 h-4 sm:h-5 mr-1 sm:mr-2"></i>
                  {% trans "Back to Dashboard" %}
              </a>
              <a href="{% url 'send_event_details' event.id %}" 
                 class="w-full sm:w-auto px-4 sm:px-6 py-2 sm:py-3 rounded-lg bg-gradient-to-r from-pink-700 to-yellow-400 text-white font-bold text-sm sm:text-base hover:text-yellow-400 hover:scale-105 transform transition duration-300">
                  <i data-lucide="send" class="w-4 sm:w-5 h-4 sm:h-5 mr-1 sm:mr-2"></i>
                  {% trans "Envoyer à l'agence" %}
              </a>
          </div>
      {% endif %}
    </div>
  </div>
</section>

<script>
  lucide.createIcons();
</script>

<style>
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px) } to { opacity: 1; transform: translateY(0) } }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(10px) } to { opacity: 1; transform: translateY(0) } }
  .animate-fadeInUp { animation: fadeInUp 0.6s ease-out both }
  .animate-fadeUp { animation: fadeUp 0.6s ease-out both }
  .delay-100 { animation-delay: 0.1s }
  .delay-200 { animation-delay: 0.2s }
  .delay-300 { animation-delay: 0.3s }
  .delay-400 { animation-delay: 0.4s }
  .delay-500 { animation-delay: 0.5s }
  .delay-600 { animation-delay: 0.6s }
  .delay-700 { animation-delay: 0.7s }
  .delay-800 { animation-delay: 0.8s }
  .delay-900 { animation-delay: 0.9s }
  .delay-1000 { animation-delay: 1.0s }
  .delay-1100 { animation-delay: 1.1s }

  @media (max-width: 640px) {
    .max-w-7xl { max-width: 100%; padding: 0 1rem; }
    .max-w-5xl { max-width: 100%; padding: 0 1rem; }
    h1 { font-size: 2rem; }
    .grid-cols-4 { grid-template-columns: 1fr; }
    .h-72 { height: 40vh; }
    button, a { width: 100%; }
  }

  @media (min-width: 641px) and (max-width: 767px) {
    .grid-cols-4 { grid-template-columns: 1fr 1fr; }
    .h-72 { height: 50vh; }
  }
</style>
{% endblock %}